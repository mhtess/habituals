---
title: "habitual priors"
author: "mht"
date: "November 18, 2015"
output: html_document
---


To reconstruct a prevalence-like distribution from the frequency dependent measure, 
we will assume there is a maximum frequency (akin to doing the action "all the time").
This will probably be set by the item: *smokes*, because it is the thing that could happen the most. 


# Prior elicitation 1

See priors1-process.Rmd for details on what was done to the data up to thsi point.

## Data analysis

```{r}
d<-read.csv("~/Documents/research/habituals/data/priors/priors-1.csv")
```

First let's look at the slider bar question (what % of the US population has done this action before?)

```{r}
## histogram of responses for existence questions
qplot(data=d, x = existence, geom='histogram')
```

Some responses are that the action is super common, or super rare, or somewhere in between. Nice spread.

Second, let's look at the times per X question.

```{r}
qplot(data=d, x = nTimes, geom='histogram')+
  facet_wrap(~timeWindow, scales='free')


range(filter(d,timeWindow=='day')$nTimes)
range(filter(d,timeWindow=='life')$nTimes)
```

Looks like the most common frequent thing happens (response) 20 times / day and the least common thing happens (response) is once (or 0 times) in a life time.

That's kind of strange. The question asked to assume that the person did it at least once. I guess there is an interpretation that the question is asking how many *more times* will they do it? How many people said 0 times in a life?

```{r}
table(filter(d,timeWindow=='life')$nTimes)
```

Just two responses were like this. All of the others said once in a life time. 

#### Preferred timeWindow

Here, I'm wondering for each item, what was the participant's preferred time window of response? I will use this to guide the default setting of interval for prior-2

```{r}


table( d$item,d$timeWindow)
```


Let's scale the data so that we're all the responses are on the same scale.
We'll see that a life time = 80 years, and scale everything to the year scale.


```{r}
scaleTime <- list(
  day = 365,
  ## day is ambiguous between work-day and day of the week
  week = 52,
  month = 12,
  year = 1,
  life = 1/80
)

d[(d$item=='drives to work' & d$timeWindow=='day'),]$nTimes <- d[(d$item=='drives to work' & d$timeWindow=='day'),]$nTimes * 5
d[(d$item=='drives to work' & d$timeWindow=='day'),]$timeWindow <- "week"

d[(d$item=='bikes to work' & d$timeWindow=='day'),]$nTimes <- d[(d$item=='bikes to work' & d$timeWindow=='day'),]$nTimes * 5
d[(d$item=='bikes to work' & d$timeWindow=='day'),]$timeWindow <- "week"

d.tidy<-d %>% 
  mutate(timeWindow = as.character(timeWindow)) %>%
  rowwise() %>%
  mutate(frequency = nTimes*scaleTime[[timeWindow]]) %>%
  ungroup()

d.tidy[d.tidy$frequency==0,]$frequency<-0.01

d.out<-d.tidy %>% 
  select(-category, -trial_type, -rt) %>%
  mutate(logFreq = log(frequency))


items <- levels(factor(d.out$item))

for (i in items){
  d.item <- d.out %>% filter(item==i)
  print(i)
  print(quantile(d.item$frequency, probs = seq(0,1,0.1)))
}
# write.csv(d.out, 
#          file="~/Documents/research/habituals/models/priors/data/prior1_workday-for-work.csv",
#          row.names=F)
```


% of Americans 
```{r}
fig.path <- "~/Documents/research/habituals/analysis/figures/"

used.in.tj<- c("bikes to work",
               "drinks beer",
               "drives to work",
               "eats granola for breakfast",
               "hikes",
               "plays computer games",
               "runs",
               "smokes",
               "steals cars",
               "vacations in Switzerland",
               "writes novels",
               "writes poems")

ggplot(d.tidy %>% filter(item%in%used.in.tj), aes(x=existence))+
  geom_histogram(binwidth=0.03)+
  #geom_density()+
  facet_wrap(~item, scales='fixed')+
  xlab("% of Americans who ___")


fig.path <- "~/Documents/research/habituals/talks/lab-mtg-120115/images/"
ggsave(paste(fig.path, "existentialQ-histogram-priors1.pdf", sep=""))
```

How often?

```{r}
ggplot(d.out %>% filter(item %in% used.in.tj), aes(x=logFreq))+
  geom_histogram(binwidth=0.5)+
  facet_wrap(~item, scales='fixed')+
  xlab("log frequency (times per year)")+
  xlim(-10,10)

ggplot(d.out %>% filter(item %in% used.in.tj), aes(x=frequency))+
  geom_histogram()+
  facet_wrap(~item, scales='free')+
  xlab("frequency (times per year)")



ggsave(paste(fig.path, "frequencyQ-log-histogram-priors1.pdf", sep=""))

#View(d.tidy)

```



```{r}

d.stats<-left_join(
  d.tidy %>% 
  group_by(item, category) %>%
  multi_boot_standard(column="frequency") %>%
  rename(freq = mean,
         freqHi = ci_upper,
         freqLo = ci_lower),
  d.tidy %>% 
  group_by(item, category) %>%
  multi_boot_standard(column="existence") %>%
  rename(exist = mean,
         existHi = ci_upper,
         existLo = ci_lower))

ggplot(d.stats, aes(x=freq, y = exist, color=category, label =item))+
  #geom_point()+
  geom_text()+
  #geom_errorbarh(aes(xmin=freqLo, xmax=freqHi))+
  #geom_errorbar(aes(ymin=existLo, ymax=existHi))+
  xlim(-0.05,1000)+
  ylim(-0.05,1.05)#+
  #coord_fixed(ratio=1)

ggsave(paste(fig.path, "priors1-scatter-text-sansSmoking.pdf", sep=""), width = 18, height =10)


with(d.stats %>% filter(item!='smokes'), cor(freq, exist))


```


# Prior elicitation 2


```{r}
d<-read.csv("~/Documents/research/habituals/data/priors/priors-2.csv")
# everyone passed the catch trial
```


```{r}
d.tidy <- d %>%
  select(workerid, category, item, ends_with("_men"), ends_with("_women"))

d.tidy[is.na(d.tidy)]<-1825 #once every 5 years

d.existence<- d.tidy %>%
  select(category, item, effectiveExistence_men, effectiveExistence_women) %>%
  gather(key, val, -category, -item)


ggplot(d.existence, aes(x=val, fill=key))+
  geom_histogram(position=position_dodge())+
  facet_wrap(~item)

d.exist.summary<- d.existence %>%
  group_by(item, key) %>%
  multi_boot_standard(column="val")

ggplot(d.exist.summary, aes(x=item, y=mean, fill=key))+
  geom_errorbar(aes(ymin=ci_lower, ymax=ci_upper), position=position_dodge())+
  geom_bar(stat='identity', position=position_dodge())+
  coord_flip()
```



```{r}



d.wait<- d.tidy %>%
  select(category, item, effectiveDayWait_men, effectiveDayWait_women) %>%
  gather(key, val, -category, -item)

ggplot(d.wait, aes(x=val, fill=key))+
  geom_histogram(position=position_dodge())+
  facet_wrap(~item)+
  xlim(0,500)

d.wait.summary<- d.wait %>%
  group_by(item, key, category) %>%
  multi_boot_standard(column="val")

ggplot(d.wait.summary, aes(x=item, y=mean, fill=key))+
  geom_hline(yintercept=365, lty=3)+
  geom_errorbar(aes(ymin=ci_lower, ymax=ci_upper), position=position_dodge())+
  geom_bar(stat='identity', position=position_dodge())+
  facet_wrap(~category)+
  coord_flip()
```
